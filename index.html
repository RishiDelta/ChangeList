<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Change Dashboard</title>
  <style>
    :root[data-theme="dark"] {
      --bg:       #0d1117;
      --surface:  #161b22;
      --border:   #30363d;
      --text:     #e6edf3;
      --muted:    #8b949e;
      --prod:     #f85149;
      --uat:      #58a6ff;
      --row-alt:  #0d1117;
      --row-hover:#1c2128;
      --toggle-bg:#30363d;
    }
    :root[data-theme="light"] {
      --bg:       #f6f8fa;
      --surface:  #ffffff;
      --border:   #d0d7de;
      --text:     #1f2328;
      --muted:    #57606a;
      --prod:     #cf222e;
      --uat:      #0969da;
      --row-alt:  #f6f8fa;
      --row-hover:#eaeef2;
      --toggle-bg:#d0d7de;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 16px;
      min-height: 100vh;
    }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 22px 36px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }

    .header-left {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.3px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 28px;
      flex-wrap: wrap;
    }

    .clocks {
      display: flex;
      align-items: center;
      gap: 24px;
    }

    .clock-item { display: flex; flex-direction: column; align-items: flex-end; }
    .clock-label { color: var(--muted); font-size: 0.8rem; margin-bottom: 3px; }
    .clock-value { font-variant-numeric: tabular-nums; font-weight: 700; font-size: 1.9rem; }
    .clock-value.session { color: #3fb950; }

    .sep { width: 1px; height: 52px; background: var(--border); }

    /* ‚îÄ‚îÄ Theme toggle ‚îÄ‚îÄ */
    .toggle-wrap {
      display: flex;
      align-items: center;
      gap: 7px;
      cursor: pointer;
      user-select: none;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .toggle {
      width: 36px;
      height: 20px;
      background: var(--toggle-bg);
      border-radius: 20px;
      position: relative;
      transition: background 0.2s;
      flex-shrink: 0;
    }

    .toggle::after {
      content: '';
      position: absolute;
      top: 3px; left: 3px;
      width: 14px; height: 14px;
      border-radius: 50%;
      background: var(--text);
      transition: transform 0.2s;
    }

    [data-theme="light"] .toggle { background: #0969da; }
    [data-theme="light"] .toggle::after { transform: translateX(16px); background: #fff; }

    /* ‚îÄ‚îÄ Main ‚îÄ‚îÄ */
    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 24px;
    }

    /* ‚îÄ‚îÄ Filters ‚îÄ‚îÄ */
    .toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .filter-group { display: flex; gap: 6px; }

    .filter-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--muted);
      cursor: pointer;
      font-size: 0.88rem;
      padding: 6px 14px;
      transition: all 0.15s;
    }

    .filter-btn:hover { color: var(--text); border-color: var(--text); }
    .filter-btn.active { color: var(--text); border-color: var(--text); font-weight: 600; }
    .filter-btn.active.prod { color: var(--prod); border-color: var(--prod); }
    .filter-btn.active.uat  { color: var(--uat);  border-color: var(--uat);  }

    .row-count { font-size: 0.78rem; color: var(--muted); }

    /* ‚îÄ‚îÄ Table ‚îÄ‚îÄ */
    .table-wrap {
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 640px;
    }

    thead tr {
      background: var(--surface);
    }

    th {
      text-align: left;
      padding: 10px 14px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      color: var(--muted);
      border-bottom: 1px solid var(--border);
      white-space: nowrap;
    }

    td {
      padding: 11px 14px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
      line-height: 1.45;
    }

    tr:last-child td { border-bottom: none; }

    tbody tr:nth-child(even) { background: var(--row-alt); }
    tbody tr:nth-child(odd)  { background: var(--surface); }
    tbody tr:hover { background: var(--row-hover); }

    tbody tr.hidden { display: none; }

    /* ‚îÄ‚îÄ Cell styles ‚îÄ‚îÄ */
    .chg-id {
      font-weight: 700;
      font-size: 1rem;
      white-space: nowrap;
    }

    .env-badge {
      display: inline-block;
      font-size: 0.8rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      padding: 3px 10px;
      border-radius: 20px;
      white-space: nowrap;
    }

    .env-badge.prod { background: rgba(248,81,73,0.12); color: var(--prod); }
    .env-badge.uat  { background: rgba(88,166,255,0.12); color: var(--uat);  }

    [data-theme="light"] .env-badge.prod { background: rgba(207,34,46,0.1); }
    [data-theme="light"] .env-badge.uat  { background: rgba(9,105,218,0.1); }

    .version { font-family: monospace; font-size: 0.9rem; color: var(--muted); }
    .time-ago { white-space: nowrap; color: var(--muted); font-size: 0.9rem; }
    .desc { font-size: 0.9rem; color: var(--muted); max-width: 340px; }

    .empty-row { display: none; text-align: center; color: var(--muted); font-size: 0.85rem; padding: 32px; }
  </style>
</head>
<body>

<header>
  <div class="header-left">Change Dashboard</div>
  <div class="header-right">
    <div class="clocks">
      <div class="clock-item">
        <span class="clock-label">Opened at</span>
        <span class="clock-value session" id="session-time">‚Äî</span>
      </div>
      <div class="sep"></div>
      <div class="clock-item">
        <span class="clock-label">Now</span>
        <span class="clock-value" id="live-time">‚Äî</span>
      </div>
    </div>
    <div class="sep"></div>
    <label class="toggle-wrap" onclick="toggleTheme()">
      <span id="theme-icon" style="font-size:1.3rem;line-height:1;">‚òÄÔ∏è</span>
      <div class="toggle"></div>
      <span id="theme-icon-right" style="font-size:1.3rem;line-height:1;">üåô</span>
    </label>
  </div>
</header>

<main>
  <div class="toolbar">
    <div class="filter-group">
      <button class="filter-btn active"      onclick="setFilter('all', this)">All</button>
      <button class="filter-btn prod"        onclick="setFilter('prod', this)">PROD</button>
      <button class="filter-btn uat"         onclick="setFilter('uat', this)">UAT</button>
    </div>
    <span class="row-count" id="row-count">6 changes</span>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Change ID</th>
          <th>Environment</th>
          <th>Service</th>
          <th>Owner</th>
          <th>Version</th>
          <th>Timestamp</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr data-env="uat" data-time="10:30" data-days="0">
          <td class="chg-id">CHG89357</td>
          <td><span class="env-badge uat">UAT</span></td>
          <td>Frontend Service</td>
          <td>Shay</td>
          <td class="version">v2.1.6</td>
          <td class="time-ago"></td>
          <td class="desc">Testing mobile responsive layout improvements for product pages. Validates cross-browser compatibility before production release.</td>
        </tr>
        <tr data-env="uat" data-time="09:15" data-days="0">
          <td class="chg-id">CHG89355</td>
          <td><span class="env-badge uat">UAT</span></td>
          <td>Ad Service</td>
          <td>Daniel</td>
          <td class="version">v1.4.2</td>
          <td class="time-ago"></td>
          <td class="desc">Testing new ad placement algorithm for homepage banner. Validates impression tracking and click-through rate measurements before production rollout.</td>
        </tr>
        <tr data-env="prod" data-time="09:00" data-days="0">
          <td class="chg-id">CHG89351</td>
          <td><span class="env-badge prod">PROD</span></td>
          <td>Checkout Service</td>
          <td>Daniel</td>
          <td class="version">v1.8.2</td>
          <td class="time-ago"></td>
          <td class="desc">Promoted UAT changes to production. Enhanced payment validation logic and added a retry mechanism for transient payment gateway failures.</td>
        </tr>
        <tr data-env="uat" data-time="21:30" data-days="1">
          <td class="chg-id">CHG89348</td>
          <td><span class="env-badge uat">UAT</span></td>
          <td>Checkout Service</td>
          <td>Daniel</td>
          <td class="version">v1.8.2</td>
          <td class="time-ago"></td>
          <td class="desc">Final UAT testing of enhanced payment validation logic. Includes retry mechanism for payment gateway timeouts and improved error messaging.</td>
        </tr>
        <tr data-env="prod" data-time="23:00" data-days="1">
          <td class="chg-id">CHG89342</td>
          <td><span class="env-badge prod">PROD</span></td>
          <td>Cart Service</td>
          <td>Shay</td>
          <td class="version">v1.2.3</td>
          <td class="time-ago"></td>
          <td class="desc">Promoted UAT changes to production. Added business metric logging for cart operations and improved session handling for better performance tracking.</td>
        </tr>
        <tr data-env="uat" data-time="09:00" data-days="1">
          <td class="chg-id">CHG89340</td>
          <td><span class="env-badge uat">UAT</span></td>
          <td>Cart Service</td>
          <td>Shay</td>
          <td class="version">v1.2.3</td>
          <td class="time-ago"></td>
          <td class="desc">Testing business metric logging for cart add/remove operations. Preparing for production deployment after successful UAT validation.</td>
        </tr>
        <tr class="empty-row" id="empty-row">
          <td colspan="7">No changes for this filter.</td>
        </tr>
      </tbody>
    </table>
  </div>
</main>

<script>
  // ‚îÄ‚îÄ Session time (persists across refreshes via sessionStorage) ‚îÄ‚îÄ
  const KEY = 'cdash_opened';
  function pad(n) { return String(n).padStart(2, '0'); }
  function fmt(d) {
    return `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
  }

  const stored = sessionStorage.getItem(KEY);
  const openedAt = stored ? new Date(+stored) : new Date();
  if (!stored) sessionStorage.setItem(KEY, openedAt.getTime());

  document.getElementById('session-time').textContent = fmt(openedAt);

  setInterval(() => {
    document.getElementById('live-time').textContent = fmt(new Date());
  }, 1000);
  document.getElementById('live-time').textContent = fmt(new Date());

  // ‚îÄ‚îÄ Timestamps in change list ‚îÄ‚îÄ
  function fmtTimestamp(d) {
    return `${pad(d.getDate())}/${pad(d.getMonth() + 1)}/${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }

  // Show a change only if its timestamp is in the past (already deployed)
  const now2 = new Date();
  let visibleCount = 0;

  document.querySelectorAll('#tbody tr[data-time]').forEach(row => {
    const [hh, mm] = row.dataset.time.split(':').map(Number);
    const days = parseInt(row.dataset.days, 10) || 0;
    const t = new Date();
    t.setDate(t.getDate() - days);
    t.setHours(hh, mm, 0, 0);

    if (t > now2) {
      row.classList.add('hidden');
      return;
    }

    row.querySelector('.time-ago').textContent = fmtTimestamp(t);
    visibleCount++;
  });

  document.getElementById('row-count').textContent = `${visibleCount} change${visibleCount !== 1 ? 's' : ''}`;

  // ‚îÄ‚îÄ Theme toggle ‚îÄ‚îÄ
  function applyThemeIcons(theme) {
    const sun  = document.getElementById('theme-icon');
    const moon = document.getElementById('theme-icon-right');
    if (theme === 'dark') {
      sun.style.opacity  = '0.35';
      moon.style.opacity = '1';
    } else {
      sun.style.opacity  = '1';
      moon.style.opacity = '0.35';
    }
  }

  function toggleTheme() {
    const html = document.documentElement;
    const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    html.setAttribute('data-theme', next);
    localStorage.setItem('cdash_theme', next);
    applyThemeIcons(next);
  }

  // Restore saved theme
  const savedTheme = localStorage.getItem('cdash_theme');
  if (savedTheme) {
    document.documentElement.setAttribute('data-theme', savedTheme);
    applyThemeIcons(savedTheme);
  } else {
    applyThemeIcons('dark');
  }

  // ‚îÄ‚îÄ Filter ‚îÄ‚îÄ
  function setFilter(filter, btn) {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    const rows = document.querySelectorAll('#tbody tr[data-env]');
    let count = 0;
    rows.forEach(row => {
      const show = filter === 'all' || row.dataset.env === filter;
      row.classList.toggle('hidden', !show);
      if (show) count++;
    });

    document.getElementById('empty-row').style.display = count === 0 ? 'table-row' : 'none';
    document.getElementById('row-count').textContent = `${count} change${count !== 1 ? 's' : ''}`;
  }
</script>

</body>
</html>
